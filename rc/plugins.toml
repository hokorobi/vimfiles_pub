# Plugin Manager {{{1
[[plugins]]
repo = 'Shougo/dein.vim'
# memo
# on_source: このプラグインがリストのプラグインより先に読み込まれる
# depends: リストのプラグインがこのプラグインより先に読み込まれる
# on_cmd: 自分で定義したコマンドは登録しない。一度実行したら消えるみたい。
hook_post_source = '''
  autocmd vimrc BufRead,InsertEnter */rc/*.toml call dein#toml#syntax()
'''

[[plugins]]
repo = 'hokorobi/vim-templug'
on_cmd = 'Templug'
hook_add = '''
  set packpath+=~/_vim
'''

# }}}1  LSP {{{1
[[plugins]]
repo = 'prabirshrestha/vim-lsp'
# on_ft を使うとうまく動かなかった
hook_add = '''
  " hook_source だとうまく動かなかった

  " let g:lsp_log_verbose = 1
  " let g:lsp_log_file = expand('~/_vim/.log/vim-lsp.log')
  let g:lsp_diagnostics_float_cursor = 1
  let g:lsp_diagnostics_float_delay = 200
  let g:lsp_document_highlight_enabled = 0
  " A> 非表示
  let g:lsp_document_code_action_signs_enabled = 0

  " https://vim-jp.slack.com/archives/CQ57P4XU4/p1614523430139700
  function! s:lsp_format() abort
    silent LspDocumentFormatSync
    LspCodeActionSync source.organizeImports
  endfunction
  function! s:on_lsp_buffer_enabled() abort
    if &l:buftype isnot# '' || win_gettype() isnot# ''
      return
    endif

    setlocal omnifunc=lsp#complete
    setlocal signcolumn=yes

    " keymap
    nmap <buffer> <Leader>al <plug>(lsp-document-diagnostics)
    " 言語によっては LS が対応していない機能もあり、その場合は元の機能を使いたいので確実なものだけ設定。
    if &filetype is# 'go' || &filetype is# 'python'
      nmap <buffer> K <plug>(lsp-hover)
      nmap <buffer> gd <plug>(lsp-definition)
      nmap <buffer> <C-]> <plug>(lsp-definition)
      nmap <buffer> <Leader>ar <plug>(lsp-rename)
      nmap <buffer> <Leader>aR <plug>(lsp-references)
    endif

    " submode
    call submode#enter_with('lsp', 'n', 'br', '<Leader>aj', '<plug>(lsp-next-diagnostic-nowrap)')
    call submode#enter_with('lsp', 'n', 'br', '<Leader>an', '<plug>(lsp-next-diagnostic-nowrap)')
    call submode#enter_with('lsp', 'n', 'br', '<Leader>ak', '<plug>(lsp-previous-diagnostic-nowrap)')
    call submode#enter_with('lsp', 'n', 'br', '<Leader>ap', '<plug>(lsp-previous-diagnostic-nowrap)')
    call submode#map('lsp', 'n', 'brs', 'j', '<plug>(lsp-next-diagnostic-nowrap)')
    call submode#map('lsp', 'n', 'brs', 'n', '<plug>(lsp-next-diagnostic-nowrap)')
    call submode#map('lsp', 'n', 'brs', 'k', '<plug>(lsp-previous-diagnostic-nowrap)')
    call submode#map('lsp', 'n', 'brs', 'p', '<plug>(lsp-previous-diagnostic-nowrap)')

    if &filetype is# 'go'
      augroup vimrc-plugin-lsp-ft-go
        autocmd! * <buffer>
        autocmd BufWritePre <buffer> call s:lsp_format()
      augroup END
    endif
  endfunction
  autocmd vimrc User lsp_buffer_enabled call s:on_lsp_buffer_enabled()
'''

[[plugins]]
repo = 'mattn/vim-lsp-settings'
depends = 'vim-lsp'
hook_add = '''
  let g:lsp_settings_servers_dir = expand('~/_vim/lspservers')
  let g:lsp_settings = {}
  " https://github.com/tsuyoshicho/vimrc-reading/blob/ad6df8bdac68ccbba4c0457797a1f9db56fcdca1/.vim/rc/dein.toml#L2928-L2941
  let g:lsp_settings['gopls'] = #{
    \  workspace_config: #{
    \    usePlaceholders: v:true,
    \    analyses: #{
    \      fillstruct: v:true,
    \    },
    \  },
    \  initialization_options: #{
    \    usePlaceholders: v:true,
    \    analyses: #{
    \      fillstruct: v:true,
    \    },
    \  },
    \}
  let g:lsp_settings['deno'] = #{
    \  blocklist: ['javascript'],
    \}
  let g:lsp_settings_enable_suggestions = 0
'''

# [[plugins]]
# repo = 'tsuyoshicho/vim-efm-langserver-settings'
# depends = 'vim-lsp'
# hook_add = '''
#   let g:efm_langserver_settings#filetype_whitelist = ['vim']
# '''

# }}}1  Completion {{{1
# [[plugins]]
# repo = 'gelguy/wilder.nvim'
# on_event = 'CmdlineEnter'
# hook_source = '''
#   cmap <expr> <Tab> wilder#in_context() ? wilder#next() : "\<Tab>"
#   cmap <expr> <C-j> wilder#in_context() ? wilder#next() : "\<C-j>"
#   cmap <expr> <S-Tab> wilder#in_context() ? wilder#previous() : "\<S-Tab>"
#   cmap <expr> <C-k> wilder#in_context() ? wilder#previous() : "\<C-k>"
#
#   call wilder#setup({'modes': ['/', '?', ':']})
#
#   " Use popupmenu
#   call wilder#set_option('renderer', wilder#popupmenu_renderer({
#       \ 'highlighter': wilder#basic_highlighter(),
#       \ }))
# '''

# }}}1  REPL {{{1

# Quickrun {{{2
[[plugins]]
repo = 'thinca/vim-quickrun'
on_cmd = 'QuickRun'
depends = 'shabadou.vim'
hook_add = '''
  call extend(g:vimrc_altercmd_dic, {
    \ 'qr\%[un]': 'Quickrun',
    \ 'r\%[un]': 'Quickrun',
    \})
'''
hook_source = '''
  let g:quickrun_config = get(g:, 'quickrun_config', {})
  let g:quickrun_config._ = {
        \   'runner': 'job',
        \   'outputter': 'buffer',
        \   'outputter/buffer/close_on_empty': 1,
        \ }

  let g:sayonara_filetypes.quickrun = 'bwipeout!'
'''

[[plugins]]
repo = 'osyo-manga/shabadou.vim'

# }}}2

[[plugins]]
repo = 'rhysd/reply.vim'
on_cmd = ['Repl', 'ReplAuto']

# }}}1  Text Object {{{1
[[plugins]]
repo = 'kana/vim-textobj-user'

[[plugins]]
repo = 'mattn/vim-textobj-url'
depends = 'vim-textobj-user'
on_map = {ox = ['iu', 'au']}

[[plugins]]
repo = 'machakann/vim-sandwich'
hook_add = '''
  let g:operator_sandwich_no_default_key_mappings = v:true

  BulkMap nx s <Nop>

  nmap sc  <Plug>(operator-sandwich-replace)<Plug>(operator-sandwich-release-count)<Plug>(textobj-sandwich-query-a)
  nmap scc <Plug>(operator-sandwich-replace)<Plug>(operator-sandwich-release-count)<Plug>(textobj-sandwich-auto-a)
  nmap cs  <Plug>(operator-sandwich-replace)<Plug>(operator-sandwich-release-count)<Plug>(textobj-sandwich-query-a)
  nmap css <Plug>(operator-sandwich-replace)<Plug>(operator-sandwich-release-count)<Plug>(textobj-sandwich-auto-a)
  BulkMap xo sc <Plug>(operator-sandwich-replace)

  nmap sr  <Plug>(operator-sandwich-replace)<Plug>(operator-sandwich-release-count)<Plug>(textobj-sandwich-query-a)
  nmap srr <Plug>(operator-sandwich-replace)<Plug>(operator-sandwich-release-count)<Plug>(textobj-sandwich-auto-a)
  " nmap rss <Plug>(operator-sandwich-replace)<Plug>(operator-sandwich-release-count)<Plug>(textobj-sandwich-auto-a)
  BulkMap xo sr <Plug>(operator-sandwich-replace)

  nmap sd  <Plug>(operator-sandwich-delete)<Plug>(operator-sandwich-release-count)<Plug>(textobj-sandwich-query-a)
  nmap sdd <Plug>(operator-sandwich-delete)<Plug>(operator-sandwich-release-count)<Plug>(textobj-sandwich-auto-a)
  nmap ds  <Plug>(operator-sandwich-delete)<Plug>(operator-sandwich-release-count)<Plug>(textobj-sandwich-query-a)
  nmap dss <Plug>(operator-sandwich-delete)<Plug>(operator-sandwich-release-count)<Plug>(textobj-sandwich-auto-a)
  BulkMap xo sd <Plug>(operator-sandwich-delete)

  nmap saa <Plug>(operator-sandwich-add)<Plug>(operator-sandwich-release-count)<Plug>(textobj-sandwich-auto-a)
  BulkMap nxo sa <Plug>(operator-sandwich-add)
  " https://github.com/machakann/vimrc/blob/3dc16ac1ae31197e35bebdf3f0fbf275117478bd/.vimrc#L1127-L1152
  nmap s( <Plug>(operator-sandwich-add-query1st)(
  nmap s8 <Plug>(operator-sandwich-add-query1st)(
  nmap s) <Plug>(operator-sandwich-add-query1st))
  nmap s9 <Plug>(operator-sandwich-add-query1st))
  xmap s( <Plug>(operator-sandwich-add)(
  xmap s8 <Plug>(operator-sandwich-add)(
  xmap s) <Plug>(operator-sandwich-add))
  xmap s9 <Plug>(operator-sandwich-add))
  nmap s[ <Plug>(operator-sandwich-add-query1st)[
  nmap s] <Plug>(operator-sandwich-add-query1st)]
  xmap s[ <Plug>(operator-sandwich-add)[
  xmap s] <Plug>(operator-sandwich-add)]
  nmap s{ <Plug>(operator-sandwich-add-query1st){
  nmap s} <Plug>(operator-sandwich-add-query1st)}
  xmap s{ <Plug>(operator-sandwich-add){
  xmap s} <Plug>(operator-sandwich-add)}
  nmap s" <Plug>(operator-sandwich-add-query1st)"
  nmap s2 <Plug>(operator-sandwich-add-query1st)"
  xmap s" <Plug>(operator-sandwich-add)"
  xmap s2 <Plug>(operator-sandwich-add)"
  nmap s' <Plug>(operator-sandwich-add-query1st)'
  nmap s7 <Plug>(operator-sandwich-add-query1st)'
  xmap s' <Plug>(operator-sandwich-add)'
  xmap s7 <Plug>(operator-sandwich-add)'
  nmap sf <Plug>(operator-sandwich-add-query1st)f
  xmap sf <Plug>(operator-sandwich-add)f

  let g:textobj#sandwich#stimeoutlen = 100

  let g:sandwich#recipes = deepcopy(g:sandwich#default_recipes)
  let g:sandwich#recipes += [
        \   {'buns': ['（', '）'], 'nesting': 1, 'input': ['j(', 'j)', 'jp']},
        \   {'buns': ['「', '」'], 'nesting': 1, 'input': ['j[', 'j]', 'jb']},
        \   {'buns': ['『', '』'], 'nesting': 1, 'input': ['j{', 'j}', 'jB']},
        \   {'buns': ['【', '】'], 'nesting': 1, 'input': ['j<', 'j>', 'jk']},
        \ ]
'''

[[plugins]]
repo = 'tommcdo/vim-exchange'
on_map = {n = 'cx', x = 'X'}

[[plugins]]
repo = 'kana/vim-textobj-indent'
depends = 'vim-textobj-user'
on_map = {ox = ['ii', 'ai', 'iI']}

[[plugins]]
repo = 'glts/vim-textobj-comment'
depends = 'vim-textobj-user'

[[plugins]]
repo = 'romgrk/equal.operator'
on_map = {ox = ['i=', 'a=']}
hook_source = '''
  let g:equal_operator_default_mappings = 0

  omap i=h <Plug>(operator-lhs)
  omap a=h <Plug>(operator-Lhs)
  xmap i=h <Plug>(visual-lhs)
  xmap a=h <Plug>(visual-Lhs)

  omap i=l <Plug>(operator-rhs)
  omap a=l <Plug>(operator-Rhs)
  xmap i=l <Plug>(visual-rhs)
  xmap a=l <Plug>(visual-Rhs)
'''

[[plugins]]
repo = 'machakann/vim-textobj-functioncall'
on_map = {ox = ['if', 'af']}
hook_source = '''
  let g:textobj_functioncall_no_default_key_mappings = 1

  " func(arg)
  " <-------> af
  "      <-> if
  " https://scrapbox.io/vim-jp/sandwich,_textobj%E3%81%A7Generics%E3%82%92%E6%89%B1%E3%81%86
  xmap if <Plug>(textobj-functioncall-innerparen-i)
  omap if <Plug>(textobj-functioncall-innerparen-i)
  xmap af <Plug>(textobj-functioncall-i)
  omap af <Plug>(textobj-functioncall-i)
'''

[[plugins]]
repo = 'machakann/vim-textobj-delimited'
# hook_post_source = '''
#   let g:textobj_delimited_patterns = deepcopy(g:textobj#delimited#default_patterns)
#   " , 区切りのパターン
#   " vim-swap へ移行
#   let g:textobj_delimited_patterns += [[', *', '\m\%(, *\)\?\%([^,[\]{}]\+, *\)\+\%([^,[\]{}]\+\)\?']]
# '''

# }}}1  Language, Format, Filetype {{{1

# diff {{{2
[[plugins]]
repo = 'AndrewRadev/linediff.vim'
on_cmd = 'Linediff'
hook_add = '''
  call extend(g:vimrc_altercmd_dic, {'diffl\%[ine]': 'Linediff'})
'''
hook_source = '''
  let g:linediff_modify_statusline = 0
'''

# }}}2 Python {{{2
[[plugins]]
repo = 'hdima/python-syntax'
hook_add = '''
  let g:python_hightlight_all = 1
'''

[[plugins]]
repo = 'hynek/vim-python-pep8-indent'

# }}}2 Golang {{{2
[[plugins]]
repo = 'mattn/vim-godoc'

[[plugins]]
repo = 'mattn/vim-gorun'

[[plugins]]
repo = 'mattn/vim-goaddtags'

# }}}2 Markdown {{{2
[[plugins]]
repo = 'previm/previm'
on_cmd = 'PrevimOpen'
depends = 'open-browser.vim'

[[plugins]]
repo = 'plasticboy/vim-markdown'
hook_source = '''
  " http://mattn.kaoriya.net/software/vim/20140523124903.htm
  let g:markdown_fenced_languages = [
        \   'css',
        \   'erb=eruby',
        \   'javascript',
        \   'js=javascript',
        \   'json=javascript',
        \   'ruby',
        \   'sass',
        \   'xml',
        \ ]
'''

# }}}2 rst {{{2
[[plugins]]
repo = 'hokorobi/vim-restructuredtext'
on_ft = 'rst'
rev = 'dev'
hook_add = '''
  let g:rst_fold_enabled = 1
'''
[plugins.ftplugin]
rst = '''
  nmap <buffer> <Leader><Leader>1 <Plug>(rst-section1)
  nmap <buffer> <Leader><Leader>2 <Plug>(rst-section2)
  nmap <buffer> <Leader><Leader>3 <Plug>(rst-section3)
  nmap <buffer> <Leader><Leader>4 <Plug>(rst-section4)
  nmap <buffer> <Leader><Leader>5 <Plug>(rst-section5)
  nmap <buffer> <Leader><Leader>6 <Plug>(rst-section6)

  imap <buffer> <C-CR> <Plug>(rst-insert-samebullet)
  imap <buffer> <S-CR> <Plug>(rst-insert-childbullet)
  imap <buffer> <C-S-CR> <Plug>(rst-insert-parentbullet)

  imap <buffer> <M-CR> <Plug>(rst-insert-lineblock)
'''

# }}}2 quickfix {{{2
[[plugins]]
repo = 'lambdalisue/qfloc.vim'
on_ft = 'qf'
hook_add = '''
  " TODO: LSP を使わない filetype では有効にする
  let g:qfloc_disable_sign = v:true
  let g:qfloc_disable_default_mappings = v:true
  let g:qfloc_disable_hover = v:true

  nmap Q <Plug>(qfloc-cswitch)
  nmap L <Plug>(qfloc-lswitch)
  " nmap <expr> ]c &diff ? ']c' : '<Plug>(qfloc-cnext)'
  " nmap <expr> [c &diff ? '[c' : '<Plug>(qfloc-cprevious)'
  " nmap ]l <Plug>(qfloc-lnext)
  " nmap [l <Plug>(qfloc-lprevious)
'''
[plugins.ftplugin]
qf = '''
  " qf.vim
  " nmap <buffer> j <Plug>(qfloc-j)
  " nmap <buffer> k <Plug>(qfloc-k)
  " nmap <buffer> s <Plug>(qfloc-sbuffer)
  " nmap <buffer> p <Plug>(qfloc-preview)
  nmap <buffer> u <Plug>(qfloc-undo)
  nmap <buffer> dd <Plug>(qfloc-delete)
  xmap <buffer> d  <Plug>(qfloc-delete)
'''

[[plugins]]
repo = 'thinca/vim-qfreplace'
on_cmd = 'Qfreplace'

# preview Quickfix at popup
[[plugins]]
repo = 'AndrewRadev/quickpeek.vim'
on_ft = 'qf'
[plugins.ftplugin]
qf = '''
  nnoremap <buffer> p <Cmd>QuickpeekToggle<CR>
'''

[[plugins]]
repo = 'mattn/vim-qfnavigate'
on_map = '<Plug>'
hook_add = '''
  nmap <silent> <F10> <plug>(qfnavigate-next)
  nmap <silent> <S-F10> <plug>(qfnavigate-previous)
  nmap <silent> <F11> <plug>(qfnavigate-previous)
'''

[[plugins]]
repo = 'yssl/QFEnter'
on_ft = 'qf'

# }}}2 Vim {{{2
[[plugins]]
repo = 'vim-jp/syntax-vim-ex'

# Vim script の最後に発生したエラーの箇所を開く
[[plugins]]
repo = 'rbtnn/vim-vimscript_lasterror'
on_cmd = 'VimscriptLastError'

[[plugins]]
repo = 'rbtnn/vim-vimscript_tagfunc'
on_ft = 'vim'

[[plugins]]
repo = 'rbtnn/vim-vimscript_indentexpr'
on_ft = 'vim'

# }}}2 Others {{{2
[[plugins]]
repo = 'pangloss/vim-javascript'

[[plugins]]
repo = 'tsuyoshicho/plantuml-previewer.vim'
rev = '57dd426'
frozen = 1
depends = 'open-browser.vim'
on_cmd = 'PlantumlOpen'
hook_source = '''
  let g:plantuml_previewer#plantuml_jar_path = g:plantuml_path
'''

[[plugins]]
repo = 'hokorobi/plantuml-syntax'
rev = 'dev'
merged = 0

[[plugins]]
repo = 'hnamikaw/vim-autohotkey'

[[plugins]]
repo = 'mechatroner/rainbow_csv'
on_cmd = 'RainbowDelim'

# [[plugins]]
# repo = 'mattn/emmet-vim'
# on_ft = 'html'

[[plugins]]
repo = 'hokorobi/vim-howm-syntax-mini'

[[plugins]]
repo = 'alvan/vim-closetag'
on_ft = ['html', 'xml']

#}}}2

# }}}1  Look {{{1
[[plugins]]
repo = 'rhysd/vim-color-spring-night'
hook_add = '''
  let g:spring_night_kill_italic = 1
  let g:spring_night_kill_bold = 1
'''

# インクリメンタルサーチの件数をポップアップ表示
[[plugins]]
repo = 'obcat/vim-hitspop'
on_event = 'CmdlineEnter'
hook_source = '''
  let g:hitspop_line = 'winbot'
  let g:hitspop_column = 'winleft'
  let g:hitspop_timeout = 100
  highlight link hitspopErrorMsg ErrorMsg
  highlight link hitspopNormal ErrorMsg
'''

[[plugins]]
repo = 'itchyny/lightline.vim'
depends = 'vim-color-spring-night'
hook_add = '''
  let g:unite_force_overwrite_statusline = 0
  let g:vimfiler_force_overwrite_statusline = 0
  let g:vimshell_force_overwrite_statusline = 0

  let g:lightline = {
        \   'colorscheme': 'spring_night',
        \   'active': {
        \     'left': [['mode', 'paste'], ['readonly', 'filename', 'modified', 'pwd']],
        \     'right': [['lineinfo'], ['fileformat', 'fenc', 'filetype']]
        \   },
        \   'mode_map': {
        \     'n' : 'N',
        \     'i' : 'I',
        \     'R' : 'R',
        \     'v' : 'V',
        \     'V' : 'VL',
        \     "\<C-v>": 'VB',
        \     'c' : 'C',
        \     's' : 'S',
        \     'S' : 'SL',
        \     "\<C-s>": 'SB',
        \     't': 'T',
        \   },
        \   'component': {
        \     'lineinfo': ':%-2v',
        \   },
        \   'component_function': {
        \     'swap': 'Swap',
        \     'pwd': 'getcwd',
        \     'fenc': 'LightlineFenc',
        \     'filename': 'LightlineFilename',
        \     'fileformat': 'LightlineFileformat',
        \     'filetype': 'LightlineFiletype',
        \   },
        \   'component_type': {
        \     'buffers': 'tabsel',
        \   },
        \ }

  " https://github.com/thinca/config/blob/a8e3ee41236fcdbfcfa77c954014bc977bc6d1c6/dotfiles/dot.vim/vimrc#L378
  function! Swap()
    return get(b:, 'swapfile_exists', 0) ? 'swp' : ''
  endfunction

  function! LightlineFilename() abort
    " quickfixリストを生成したコマンド or ディレクトリ名付き filename
    return &buftype ==# 'quickfix' ? get(w:, 'quickfix_title', '') : fnamemodify(bufname('%'), ':.')
  endfunction

  " BOM も表示する fenc
  function! LightlineFenc() abort
    if winwidth(0) < 70
      return ''
    endif

    let fenc = &fileencoding == '' ? &encoding : &fileencoding
    return fenc !=# 'utf-8' ? fenc : &bomb ? fenc .. ' (BOM)' : fenc
  endfunction

  function! LightlineFiletype() abort
    return winwidth(0) < 70 ? '' : &filetype ==# '' ? 'no ft' : &filetype
  endfunction

  function! LightlineFileformat() abort
    return winwidth(0) < 70 ? '' : &fileformat
  endfunction
'''

[[plugins]]
repo = 'itchyny/vim-cursorword'

# replace matchparen
[[plugins]]
repo = 'andymass/vim-matchup'
hook_add = '''
  " sandwich の ib ab を使うため ds% cs% は無効にする
  let g:matchup_surround_enabled = 0

  " popup で表示
  let g:matchup_matchparen_offscreen = {'method': 'popup'}

  " 関数内部の return などに移動せず関数先頭と末尾を行き来する。
  let g:matchup_delim_nomids = 1

  BulkMap nxo <Leader><Space> <Plug>(matchup-%)
'''

[[plugins]]
repo = 't9md/vim-quickhl'
on_map = '<Plug>'
hook_add = '''
  BulkMap nx <Leader>m <Plug>(quickhl-manual-this)
  BulkMap nx <Leader>M <Plug>(quickhl-manual-reset)
'''

# :substitute などで変更対象のハイライト、変更後のプレビュー
[[plugins]]
repo = 'markonm/traces.vim'
on_event = 'CmdlineEnter'
hook_source = '''
  let g:traces_num_range_preview = 1
  let g:traces_preview_window = 'botright 10new'
  let g:traces_normal_preview = 1
'''

[[plugins]]
repo = 'liuchengxu/vista.vim'
on_cmd = 'Vista'
hook_source = '''
  let g:sayonara_filetypes.vista = 'Vista!'
'''

[[plugins]]
repo = 'lambdalisue/readablefold.vim'

# #rrggbb や #rgb の色を視覚化
[[plugins]]
repo = 'BourgeoisBear/clrzr'
on_cmd = 'ClrzrOn'
hook_add = '''
  call extend(g:vimrc_altercmd_dic, {
        \   'colorh\%[ighlight]': 'ClrzrOn | ClrzrRefresh',
        \ })
'''

[[plugins]]
repo = 'machakann/vim-highlightedyank'
hook_add = '''
  let g:highlightedyank_highlight_duration = 300
  highlight HighlightedyankRegion cterm=reverse gui=reverse
'''

[[plugins]]
repo = 'rbtnn/vim-ambiwidth'
hook_add = '''
  let g:ambiwidth_cica_enabled = v:false
'''

# }}}1  Input & Edit {{{1
[[plugins]]
repo = 'cohama/lexima.vim'
on_event = ['InsertEnter', 'CmdlineEnter']
hook_source = '''
  let g:lexima_ctrlh_as_backspace = 1

  source ~/vimfiles/rc/lexima.vim
  " 継続行の改行時に \ を入力するため
  autocmd vimrc FileType vim nmap <buffer> o A<CR>

  " alter altercmd
  " https://github.com/yuki-yano/dotfiles/blob/7062b0f72d191d15fe403bf43f6e7b54d4c64089/.vimrc#L3335-L3346
  " https://scrapbox.io/vim-jp/lexima.vim%E3%81%A7Better_vim-altercmd%E3%82%92%E5%86%8D%E7%8F%BE%E3%81%99%E3%82%8B
  function! s:lexima_alter_command(original, altanative) abort
    let input_space = '<C-w>' .. a:altanative .. '<Space>'
    let input_cr    = '<C-w>' .. a:altanative .. '<CR>'

    let rule = {
    \ 'mode': ':',
    \ 'at': '^\(''<,''>\)\?' .. a:original .. '\%#$',
    \ }

    call lexima#add_rule(extend(rule, #{char: '<Space>', input: input_space }))
    call lexima#add_rule(extend(rule, #{char: '<CR>',    input: input_cr }))
  endfunction

  for [key, value] in items(g:vimrc_altercmd_dic)
    call s:lexima_alter_command(key, value)
  endfor
'''

[[plugins]]
repo = 'thinca/vim-ambicmd'
on_event = ['CmdlineEnter']
depends = 'lexima.vim'
hook_source = '''
  "https://scrapbox.io/vim-jp/lexima%E3%81%A8ambicmd%E3%82%92cmdline%E3%81%A7%E4%BD%B5%E7%94%A8%E3%81%99%E3%82%8B
  function! s:expand_command(key) abort
    let key2char = { "\<Space>": ' ', "\<CR>": "\r" }
    let key2lexima = { "\<Space>": '<Space>', "\<CR>": '<CR>' }

    let lexima = lexima#expand(key2lexima[a:key], ':')
    if lexima !=# key2char[a:key]
      return lexima
    endif

    let ambicmd = ambicmd#expand(a:key)
    if ambicmd !=# key2char[a:key]
      return ambicmd
    endif

    return a:key
  endfunction

  cnoremap <expr> <Space> <SID>expand_command("\<Space>")
  cnoremap <expr> <CR>    <SID>expand_command("\<CR>")
'''

[[plugins]]
repo = 'uplus/vim-clurin'
on_map = '<Plug>'
hook_add = '''
  nmap + <Plug>(clurin-next)
  nmap - <Plug>(clurin-prev)
'''
# 設定に ''' が入っているので """ """ でくくらないと駄目。
hook_source = """
  let g:clurin = {
        \   '-': {
        \     'use_default': 0,
        \     'def': [
        \       ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
        \       ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'],
        \       ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        \       ['月', '火', '水', '木', '金', '土', '日'],
        \       ['true', 'false'],
        \       ['True', 'False'],
        \       ['on', 'off'],
        \       ['enable', 'disable'],
        \       ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        \       ['yes', 'no'],
        \       ['left', 'right'],
        \       ['=', ' = '],
        \       ['+', ' + '],
        \       ['-', ' - '],
        \       ['*', ' * '],
        \       ['/', ' / '],
        \       ['pick', 'reword', 'edit', 'squash', 'fixup'],
        \   ]},
        \   'toml vim': {
        \     'def': [[
        \       {'pattern': '"\([^"]*\)"'  , 'replace': '"\1"'},
        \       {'pattern': '''\([^'']*\)''', 'replace': '''\1'''},
        \   ]]},
        \}
"""

[[plugins]]
repo = 'junegunn/vim-easy-align'
on_cmd = 'EasyAlign'
on_map = '<Plug>(EasyAlign'
hook_add = '''
  vmap <Enter> <Plug>(EasyAlign)
'''

[[plugins]]
repo = 'mbbill/undotree'
on_cmd = 'UndotreeToggle'
hook_add = '''
  nnoremap [toggle]u <Cmd>UndotreeToggle<CR>
  call extend(g:vimrc_altercmd_dic, {
        \   'undot\%[reetoggle]': 'UndotreeToggle',
        \ })
'''
hook_source = '''
  let g:undotree_WindowLayout = 2
  let g:undotree_SetFocusWhenToggle = 1
  let g:undotree_ShortIndicators = 1
'''

[[plugins]]
repo = 'osyo-manga/vim-jplus'
on_map = '<Plug>'
hook_add = '''
  " 空白を削除して行を結合
  " 空白ありで連結のほうが使うことが多い。
  "BulkMap nx J <Plug>(jplus-input)<CR>

  " 空白を削除した上で任意の文字を挿入して行を結合
  BulkMap nx <Leader>J <Plug>(jplus-input)
'''

[[plugins]]
repo = 'hokorobi/yankround.vim'
on_map = {n = '<Leader>f', nx = '<Plug>'}
on_cmd = 'CtrlPYankRound'
hook_add = '''
  BulkMap nx <expr> P yankround#is_active() ? '<Plug>(myyr)' : '<Plug>(yankround-P)'
  BulkMap nx <expr> p yankround#is_active() ? '<Plug>(myyr)' : '<Plug>(yankround-p)'
  nnoremap <leader>fp <Cmd>CtrlPYankRound<CR>

  let g:yankround_dir = expand('~/_vim/.yankround')
  let g:yankround_use_region_hl = 1
'''
hook_source = '''
  " submode
  call submode#enter_with('yr', 'n', 'r', '<Plug>(myyr)', '<Plug>(yankround-prev)')
  call submode#map('yr', 'n', 'rs', 'p', '<Plug>(yankround-prev)')
  call submode#map('yr', 'n', 'rs', 'n', '<Plug>(yankround-next)')
  call submode#map('yr', 'n', 'rs', 'P', '<Plug>(yankround-next)')
'''

# g<C-a> などは同行での連番はできないようなので、まだ有用
[[plugins]]
repo = 'deris/vim-rengbang'
on_cmd = ['RengBang', 'RengBangUsePrev', 'RengBangConfirm']
hook_source = '''
  let g:rengbang_default_start = 1
'''

[[plugins]]
repo = 'ntpeters/vim-better-whitespace'
on_cmd = ['StripWhitespace', 'ToggleStripWhitespaceOnSave']
hook_add = '''
  command! WhitespaceStrip :StripWhitespace
'''

[[plugins]]
repo = 'mattn/vim-sonictemplate'
on_cmd = 'Template'
on_map = {ni = '<C-y>'}
hook_add = '''
  let g:sonictemplate_vim_template_dir = [
    \   '$HOME/vimfiles/rc/sonictemplate',
    \   '$HOME/_vim/dein/repos/github.com/mattn/vim-sonictemplate/template',
    \]

  if exists('g:howm_dir') && isdirectory(g:howm_dir)
    nnoremap <Leader>,c <Cmd>call vimrc#EditHowmNew(g:howm_dir)<CR>
  endif

  autocmd vimrc FileType toml imap <buffer> <C-t> .plugin<C-R>=sonictemplate#postfix()<CR>
'''

[[plugins]]
repo = 'deris/vim-pasta'
on_map = {nx = ['<Space>p', '<Space>P']}
hook_source = '''
  let g:pasta_paste_before_mapping = '<Space>P'
  let g:pasta_paste_after_mapping = '<Space>p'
'''

[[plugins]]
repo = 'nocd5/ExpandSerialNumber.vim'
on_cmd = 'ExpandSerialNumber'

[[plugins]]
repo = 'lambdalisue/vim-findent'
on_cmd = ['Findent', 'FindentRestore']
hook_add = '''
  let g:findent#enable_messages = 0
  autocmd vimrc FileType autohotkey,javascript,json,neosnippet,plantuml,python,ruby,vim Findent
'''

[[plugins]]
repo = 'machakann/vim-swap'
hook_add = '''
  BulkMap xo i, <Plug>(swap-textobject-i)
  BulkMap xo a, <Plug>(swap-textobject-a)

  " タブ区切りも要素とする。
  let g:swap#rules = deepcopy(g:swap#default_rules)
  let g:swap#rules += [{
        \   "delimiter": ['\t'],
        \   "body": '.\+',
        \ }]

  " 行内の要素をソートする
  command! SortLine execute 'normal gss<ESC>'
'''

# 選択した行すべてに対して I, A を反映させる。
[[plugins]]
repo = 'kana/vim-niceblock'
on_map = {x = ['I', 'gI', 'A']}

[[plugins]]
repo = 'tyru/caw.vim'
depends = 'vim-repeat'
on_map = '<Plug>(caw:prefix)'
hook_add = '''
  BulkMap nx gc <Plug>(caw:prefix)
  " 現在行をコピーしてコメントアウト
  nmap gcy yypgcIk
  " 選択範囲をコピーしてコメントアウト
  xmap gcy ygvgcIp
'''

[[plugins]]
repo = 'kana/vim-repeat'
lazy = 1

[[plugins]]
repo = 'matze/vim-move'
on_map = '<Plug>Move'
hook_add = '''
  let g:move_map_keys = 0
  nmap <C-Up> <Plug>MoveLineUp
  xmap <C-Up> <Plug>MoveBlockUp
  nmap <C-Down> <Plug>MoveLineDown
  xmap <C-Down> <Plug>MoveBlockDown
  nmap <A-l> <Plug>MoveCharRight
  xmap <A-l> <Plug>MoveBlockRight
  nmap <A-h> <Plug>MoveCharLeft
  xmap <A-h> <Plug>MoveBlockLeft
'''

[[plugins]]
repo = 'sentriz/vim-print-debug'
on_func = 'print_debug#print_debug'
hook_source = '''
  let g:print_debug_templates = {
    \   'go':         'fmt.Printf("+++ {}\n")',
    \   'python':     'print(f"+++ {}")',
    \   'javascript': 'console.log(`+++ {}`);',
    \   'c':          'printf("+++ {}\n");',
    \   'vim':        'echom "+++"',
    \ }
'''

# }}}1  Motion {{{1
[[plugins]]
repo = 'easymotion/vim-easymotion'
on_map = {nxo = '<Plug>'}
hook_add = '''
  "map g/ <Plug>(easymotion-sn)

  " bd: bidirection
  " ?l: current line
  BulkMap nxo ss <Plug>(easymotion-overwin-f2)
  BulkMap nxo f <Plug>(easymotion-bd-fl)
  BulkMap nxo F <Plug>(easymotion-Fl)
  BulkMap nxo t <Plug>(easymotion-bd-tl)
  BulkMap nxo T <Plug>(easymotion-Tl)

  let g:EasyMotion_move_highlight = 0

  highlight link EasyMotionTarget DiffDelete
'''
hook_source = '''
  let g:EasyMotion_do_mapping = 0
  let g:EasyMotion_keys = 'hlasdgyuiopqwertnmzxcvbfkj;'
  let g:EasyMotion_smartcase = 1
  " PCを新しくしたらマシな速さになったみたい
  let g:EasyMotion_use_migemo = 1
  let g:EasyMotion_space_jump_first = 1
  let g:EasyMotion_use_smartsign_us = 1
  let g:EasyMotion_do_shade = 0

  " submode
  call submode#enter_with('emn', 'nx', 'r', ':', '<Plug>(easymotion-next)')
  call submode#enter_with('emn', 'nx', 'r', '<Space>;', '<Plug>(easymotion-next)')
  call submode#enter_with('emn', 'nx', 'r', ',', '<Plug>(easymotion-prev)')
  call submode#map('emn', 'nx', 'rs', ';', '<Plug>(easymotion-next)')
  call submode#map('emn', 'nx', 'rs', ':', '<Plug>(easymotion-next)')
  call submode#map('emn', 'nx', 'rs', ',', '<Plug>(easymotion-prev)')
'''

[[plugins]]
repo = 'haya14busa/vim-edgemotion'
on_map = '<Plug>'
hook_add = '''
  BulkMap nx <Leader>j <Plug>(edgemotion-j)
  BulkMap nx <Leader>k <Plug>(edgemotion-k)
'''

[[plugins]]
repo = 'haya14busa/vim-asterisk'
on_map = '<Plug>'
hook_add = '''
  map * <Plug>(asterisk-gz*)
  map g* <Plug>(asterisk-z*)
  map z* <Plug>(asterisk-*)
  map gz* <Plug>(asterisk-g*)

  " replace
  map # <Plug>(asterisk-gz*)cgn
  map g# <Plug>(asterisk-z*)cgn
'''

[[plugins]]
repo = 'hrsh7th/vim-searchx'
on_func = 'searchx#run'
hook_add = '''
  " Overwrite / and ?.
  BulkMap nx ? <Cmd>call searchx#start({ 'dir': 0 })<CR>
  BulkMap nx / <Cmd>call searchx#start({ 'dir': 1 })<CR>

  " Move to next/prev match.
  BulkMap nx N <Cmd>call searchx#prev_dir()<CR>
  BulkMap nx n <Cmd>call searchx#next_dir()<CR>
  xnoremap <C-k> <Cmd>call searchx#prev()<CR>
  xnoremap <C-j> <Cmd>call searchx#next()<CR>
  cnoremap <expr> <C-k> getcmdtype() ==# ':' ? repeat('<Del>', strchars(getcmdline()[getcmdpos() - 1:])) : '<Cmd>call searchx#prev()<CR>'
  cnoremap <C-j> <Cmd>call searchx#next()<CR>

  " Customize behaviors.
  let g:searchx = {}

  " Auto jump if the recent input matches to any marker.
  let g:searchx.auto_accept = v:true

  " Marker Characters
  let g:searchx.markers = split('JFKLUIONMHYDVCRETGB', '.\zs')

  " Convert search pattern.
  function g:searchx.convert(input) abort
    if a:input !~# '\k'
      return '\V' .. a:input
    endif
    return join(split(a:input, ' '), '.\{-}')
  endfunction

  " auto nohlsearch after cursor is moved.
  " vim-hitspop の表示も消してもらえるので is.vim も削除した
  let g:searchx.nohlsearch = {}
  let g:searchx.nohlsearch.jump = v:true
'''

# カーソル移動位置を遡る
[[plugins]]
repo = 'osyo-manga/vim-milfeulle'
hook_add = '''
  " バッファ単位で移動位置を保存
  let g:milfeulle_default_kind = 'buffer'
  " 位置の保存は CursorMoved
  let g:milfeulle_enable_CursorHold = 0
  let g:milfeulle_enable_InsertLeave = 0
  autocmd vimrc CursorMoved * MilfeulleOverlay

  nmap <C-Left> <Plug>(milfeulle-prev)
  nmap <C-Right> <Plug>(milfeulle-next)
'''

[[plugins]]
repo = 'hokorobi/vim-smarthome'
on_map = {nxi = '<Plug>'}
hook_add = '''
  BulkMap nxi <silent> <Home> <Plug>(smarthome-home)
  BulkMap nxi <silent> <C-a> <Plug>(smarthome-home)
  BulkMap nxi <silent> <M-h> <Plug>(smarthome-home)
  BulkMap nx <silent> <Leader>h <Plug>(smarthome-home)
  BulkMap nx <silent> 0 <Plug>(smarthome-home)

  BulkMap nxi <silent> <End> <Plug>(smarthome-end)
  BulkMap nxi <silent> <C-e> <Plug>(smarthome-end)
  BulkMap nxi <silent> <M-l> <Plug>(smarthome-end)
  BulkMap nx <silent> <Leader>l <Plug>(smarthome-end)
  BulkMap nx <silent> $ <Plug>(smarthome-end)
'''

[[plugins]]
repo = 'osyo-manga/vim-operator-stay-cursor'
depends = 'vim-operator-user'
hook_add = '''
  map <expr> y operator#stay_cursor#wrapper("y")
'''

# 遅延読み込みだと前回起動時のマークが復元されない様子
[[plugins]]
repo = 'hokorobi/vim-bookmarks'
#rev = 'hokorobi'
hook_add = '''
  " bookmark_auto_save_file が無効になるので g:bookmark_manage_per_buffer は 1 にしない
  let g:bookmark_auto_save_file = expand('~/_vim/.vim-bookmarks')

  let g:bookmark_sign = '>>'
  let g:bookmark_annotation_sign = '##'

  " ブックマークを開いたら候補のウィンドウは閉じる
  let g:bookmark_auto_close = 1

  let g:bookmark_no_default_key_mappings = 1
  nmap mm <Plug>BookmarkToggle
  nmap mi <Plug>BookmarkAnnotate
  nmap ma <Plug>BookmarkShowAll
  nmap <Leader>fm <Plug>BookmarkShowAll
  nmap mj <Plug>BookmarkNext
  nmap mn <Plug>BookmarkNext
  nmap mk <Plug>BookmarkPrev
  nmap mp <Plug>BookmarkPrev
  nmap mc <Plug>BookmarkClear
  nmap mx <Plug>BookmarkClearAll
'''

# }}}1  Buffer {{{1
[[plugins]]
repo = 'hokorobi/vim-sayonara'
on_func = 'sayonara#'
frozen = 1
hook_add = '''
  noremap <expr> qq '<Cmd>' .. (&diff ? 'diffoff' : 'call sayonara#sayonara(v:true)') .. '<CR>'
'''
hook_source = '''
  let g:sayonara_filetypes.qf = 'bdelete'
  let g:sayonara_filetypes.help = 'bdelete!'
'''

[[plugins]]
repo = 'tyru/closesubwin.vim'
on_func = 'closesubwin#'
hook_add ='''
  nnoremap <Leader>q <Cmd>call closesubwin#close_sub_window()<CR>
'''

[[plugins]]
repo = 'kana/vim-altr'
on_map = '<Plug>(altr-forward)'
hook_add = '''
  nmap <F2> <Plug>(altr-forward)
'''
hook_source = '''
  " https://github.com/thinca/config/blob/a109fa4a22abf9037563785a3d5fb119eb5ea2ae/dotfiles/dot.vim/vimrc#L2406
  call altr#define('%.go', '%_test.go')
'''

# }}}1  File {{{1
[[plugins]]
repo = 'kana/vim-gf-user'
on_map = {n = 'gf'}
hook_source = '''
  " Windows でも行数指定の記述を gf で開けるようにする
  " http://thinca.hatenablog.com/entry/20140324/1395590910
  call gf#user#extend('vimrc#GfFile', 1000)
'''

# diff でも gf を可能にする
[[plugins]]
repo = 'kana/vim-gf-diff'
on_ft = 'diff'
depends = 'vim-gf-user'

[[plugins]]
# FIXME: 遅延読込設定をしている場合、起動後の初回実行時にファイルの内容が二重に表示される
#        ファイル末尾にファイルの先頭からの内容が表示される。本当に先頭からではなく2行目からの様子
#        sample: :e https://raw.githubusercontent.com/Mathiasb17/mathias/f3ad028eafcc56ddd4d72019cb6a1818e456d099/.config/nvim/init.vim
repo = 'lambdalisue/vim-protocol'
on_path = '^https\?://'

[[plugins]]
repo = 'mattn/vim-findroot'
on_event = 'BufRead'
hook_source = '''
  let g:findroot_not_for_subdir = 0
'''

# }}}1  Terminal {{{1
# terminal 上で、未入力時に ESC, : が効くようにする
[[plugins]]
repo = 'tyru/empty-prompt.vim'
on_event = 'TerminalOpen'
hook_source = '''
  " let g:empty_prompt#pattern = get(g:, 'empty_prompt#pattern', &shell =~# 'sh$' ? '\$ $' : '\S>\s*$')
  " Use nyagos
  " let g:empty_prompt#pattern = '\$ $'

  " Enter command-line / normal-mode if current line is empty prompt
  function! s:empty_prompt_mappings() abort
    call empty_prompt#map(#{lhs: ';', rhs: "<C-w>:"})
    call empty_prompt#map(#{lhs: '<Esc>', rhs: "<C-w>N"})
  endfunction
  autocmd vimrc TerminalOpen * ++once call s:empty_prompt_mappings()
'''

[[plugins]]
repo = 'voldikss/vim-floaterm'
on_cmd = 'FloatermNew'
on_func = 'floaterm#'
hook_add = '''
  nnoremap <expr> <M-t> '<Cmd>' .. (floaterm#buflist#first() == -1 ? 'FloatermNew' : 'FloatermToggle') .. '<CR>'
'''
hook_source = '''
  " exit してもウィンドウが残ると閉じないといけないので
  let g:floaterm_autoclose = 1

  autocmd vimrc User FloatermOpen tnoremap <buffer> <silent> <M-t> <C-\><C-n>:FloatermToggle<CR>
  autocmd vimrc User FloatermOpen tnoremap <buffer> <silent> <C-t> <C-\><C-n>:FloatermNew<CR>
  autocmd vimrc User FloatermOpen tnoremap <buffer> <silent> <C-k> <C-\><C-n>:FloatermPrev<CR>
  autocmd vimrc User FloatermOpen tnoremap <buffer> <silent> <C-j> <C-\><C-n>:FloatermNext<CR>

  autocmd vimrc QuitPre * FloatermKill!
'''

# }}}1  CtrlP {{{1
[[plugins]]
repo = 'ctrlpvim/ctrlp.vim'
hook_add = '''
  let g:ctrlp_map = '<Nop>'

  " 候補の残りにあわせてリサイズしない
  let g:ctrlp_match_window = 'bottom,order:btt,min:2,max:20'

  " Guess vcs root dir
  let g:ctrlp_working_path_mode = 'ra'

  " Open current window
  let g:ctrlp_open_new_file = 'r'
  let g:ctrlp_open_multiple_files = 'r'

  " cache files directory
  let g:ctrlp_cache_dir = expand('~/_vim/.ctrlp')

  let g:ctrlp_switch_buffer = 0

  let g:ctrlp_regexp = 0

  " exculde mru
  let g:ctrlp_mruf_exclude = '^C:\\Users\\.*\\AppData\\Local\\Temp\\.*'

  let g:ctrlp_custom_ignore = {
    \ 'dir':  '\v[\/](\.(bzr|git|hg|svn)|node_modules|_venv)$',
    \ 'file': '\v\.(dll|exe|so)$',
    \ }

  " mapping
  let g:ctrlp_prompt_mappings = {
        \ 'AcceptSelection("e")': ['<cr>', '<2-LeftMouse>', '<m-m>'],
        \ 'PrtSelectMove("j")'  : ['<c-j>', '<down>', '<m-j>'],
        \ 'PrtSelectMove("k")'  : ['<c-k>', '<up>', '<m-k>'],
        \ 'PrtBS()'             : ['<bs>', '<c-]>', '<c-h>'],
        \ 'PrtCurLeft()'        : ['<c-b>', '<left>', '<c-^>'],
        \ 'ToggleType(-1)'      : ['<c-down>'],
        \ 'PrtCurRight()'       : ['<c-f>', '<c-l>', '<right>'],
        \ 'ToggleType(1)'       : ['<c-up>'],
        \ 'PrtInsert("c")'      : ['<c-v>', '<MiddleMouse>', '<insert>'],
        \ 'PrtDelete()'         : ['<c-d>', '<del>'],
        \ 'PrtDeleteWord()'     : ['<c-q>'],
        \ 'ToggleByFname()'     : ['<F8>'],
        \ 'AcceptSelection("v")': ['<RightMouse>'],
        \ 'PrtDeleteEnt()'      : ['<F7>', '<c-w>'],
        \ }

  nnoremap <Leader>b <Cmd>CtrlPBuffer<CR>
  nnoremap <Leader>f/ <Cmd>CtrlPLine %<CR>
  nnoremap <Leader>fo <Cmd>call vimrc#CtrlPDefaultInput('CtrlPLine %', '{{{ ')<CR>
  nnoremap <Leader>u <Cmd>CtrlPMRUFiles<CR>
  nnoremap <Leader>ff <Cmd>CtrlP<CR>
  nnoremap <Leader>fn <Cmd>call vimrc#CtrlPFilenameInsert('', '')<CR>
  nnoremap <Leader>fq <Cmd>CtrlPQuickfix<CR>
  nnoremap <Leader>fr <Cmd>call vimrc#CtrlPRepository('n')<CR>
  xnoremap <Leader>fr <Cmd>call vimrc#CtrlPRepository('x')<CR>

  " CtrlP-funky だとカレントのバッファしか対象にできないので
  nnoremap <Leader>fu <Cmd>call Funcquickfix()<CR>
  function! Funcquickfix() abort
    FuncGrep
    " QuickfixCmdPost で QuickFix が自動で開くので閉じる
    cclose
    CtrlPQuickfix
  endfunction
'''
[plugins.ftplugin]
rst = '''
  nnoremap <buffer> <Leader>fo <Cmd>call vimrc#CtrlPDefaultInput('CtrlPLine %', 'list-table ')<CR>
  nnoremap <buffer> <Leader>fn <Cmd>call vimrc#CtrlPFilenameInsert('.. image:: ', '')<CR>
'''
go = '''
  command! -buffer -nargs=0 FuncGrep :execute 'vimgrep /^\s*func\s\+/j **/*.go'
'''
javascript = '''
  command! -buffer -nargs=0 FuncGrep :execute 'vimgrep /^\s*function\s\+/j **/*.js **/*.js9'
'''
vim = '''
  command! -buffer -nargs=0 FuncGrep :execute 'vimgrep /^\s*fu\%[nction]!\?\s\+\zs[a-zA-Z0-9_#:]\+\ze\s*(/j **/*.vim'
'''

[[plugins]]
repo = 'hokorobi/ctrlp-sessions'
on_cmd = ['CtrlPSession', 'MkS']
hook_add = '''
  " nnoremap <Leader>fs <Cmd>CtrlPSessions<CR>
  " call extend(g:vimrc_altercmd_dic, {'ss': 'MkS'})

  let g:ctrlp_session_dir = expand('~/_vim/sessions')
'''

[[plugins]]
repo = 'mattn/ctrlp-launcher'
on_cmd = 'CtrlPLauncher'
hook_add = '''
  let g:ctrlp_launcher_file = expand('~/vimfiles/rc/.ctrlp-launcher')
  nnoremap <Leader>fl <Cmd>CtrlPLauncher<CR>
'''

[[plugins]]
repo = 'zeero/vim-ctrlp-help'
on_cmd = 'CtrlPHelp'
hook_add = '''
  nnoremap <Leader>fh <Cmd>CtrlPHelp<CR>

  call extend(g:vimrc_altercmd_dic, {'hh': 'CtrlPHelp'})
'''

[[plugins]]
repo = 'printesoi/ctrlp-filetype.vim'
on_cmd = 'CtrlPFiletype'
hook_add = '''
  nnoremap <Leader>ft <Cmd>CtrlPFiletype<CR>
'''

[[plugins]]
repo = 'christoomey/ctrlp-generic'
on_func = 'CtrlPGeneric'
hook_add = '''
  function! PasteCallback(selected_value) abort
    call setreg('z', a:selected_value)
    normal! "zp
  endfunction
  command! -nargs=* CtrlPCmdPaste call CtrlPGeneric(systemlist(<q-args>), 'PasteCallback')

  function! CdCallback(selected_value) abort
    execute 'cd ' .. a:selected_value
  endfunction
  nnoremap <Leader>fc <Cmd>call CtrlPGeneric(systemlist('ghq list -p'), 'CdCallback')<CR>
'''

[[plugins]]
repo = 'suy/vim-ctrlp-commandline'
hook_add = '''
  nnoremap <Leader>f; <Cmd>call ctrlp#init(ctrlp#commandline#id())<CR>
'''

[[plugins]]
repo = 'mattn/ctrlp-matchfuzzy'
hook_add = '''
  let g:ctrlp_match_func = {'match': 'ctrlp_matchfuzzy#matcher'}
'''

[[plugins]]
repo = 'kaneshin/ctrlp-git-log'
on_cmd = 'CtrlPGitLog'
hook_add = '''
  nnoremap <Leader>gl <Cmd>CtrlPGitLog<CR>
'''

# }}}1  Git {{{1
[[plugins]]
repo = 'lambdalisue/gina.vim'
on_cmd = 'Gina'
hook_add = '''
  " 開いているファイル、選択行を Github で開く
  BulkMap nx <Leader>oG <Cmd>Gina browse :<CR>

  nnoremap <Leader>gL <Cmd>Gina log --all --graph -100 --opener=split<CR>
  nnoremap <Leader>gD <Cmd>Gina diff --opener=split<CR>
  nnoremap <Leader>gS <Cmd>Gina status -s<CR>

  nnoremap <Leader>gbl <Cmd>Gina blame<CR>
  nnoremap <Leader>gg :Gina log -p -G""<Left>

  call extend(g:vimrc_altercmd_dic, {
        \   'bro\%[wse]': 'Gina browse --exact :',
        \ })

  let g:sayonara_filetypes['gina-blame'] = 'tabclose'
  let g:sayonara_filetypes['gina-log'] = 'bdelete'
'''
hook_source = '''
  " alias
  call gina#custom#command#alias('status', 'st')
  call gina#custom#command#option('st', '-s')
  " call gina#custom#command#option('status', '--opener', 'split')

  call gina#custom#command#alias('branch', 'b')

  call gina#custom#command#alias('log', 'gl')
  call gina#custom#command#option('gl', '--graph')

  " key mapping
  call gina#custom#mapping#nmap('status', 'cc', ':<C-u>Gina commit -v --group=status<CR>', {'noremap': 1, 'silent': 1, 'buffer': 1, 'nowait': 1})
  " show から戻るときは <C-o>
  call gina#custom#mapping#nmap('blame', 's', ':<C-u>Gina show<CR>', {'noremap': 1, 'silent': 1, 'buffer': 1, 'nowait': 1})
  call gina#custom#mapping#nmap('blame', 'e', '<Plug>(gina-blame-echo)', {'noremap': 0, 'buffer': 1, 'nowait': 1})
  " copy revision
  call gina#custom#mapping#nmap('log', 'yr', '<Plug>(gina-yank-rev)', {'noremap': 0, 'buffer': 1, 'nowait': 1})
'''

[[plugins]]
repo = 'lambdalisue/gin.vim'
on_cmd = ['Gin', 'GinBranch', 'GinChaperon', 'GinDiff', 'GinEdit', 'GinPatch', 'GinStatus']
depends = 'denops.vim'

[[plugins]]
repo = 'kuuote/gina-preview.vim'
on_cmd = 'GinaPreview'

[[plugins]]
repo = 'cohama/agit.vim'
on_cmd = 'Agit'
hook_source = '''
  " Sayonara
  let g:sayonara_filetypes.agit = 'tabclose'
  let g:sayonara_filetypes.agit_stat = 'tabclose'
  let g:sayonara_filetypes.agit_diff = 'tabclose'
'''

# }}}1  Utility {{{1
[[plugins]]
repo = 'tyru/open-browser.vim'
on_map = '<Plug>(openbrowser-'
on_func = 'openbrowser#open'
hook_add = '''
  nmap <Leader>oo <Plug>(openbrowser-open)
  BulkMap nx <Leader>o <Plug>(openbrowser-open)

  nnoremap <Leader>og <Cmd>call vimrc#openGithubRepository('n')<CR>
  xnoremap <Leader>og <Cmd>call vimrc#openGithubRepository('v')<CR>

  nnoremap <Leader>ob <Cmd>call vimrc#openUrlInBuffer()<CR>
'''
[plugins.ftplugin]
help = '''
  nmap <silent> <buffer> o <Plug>(openbrowser-open)
'''

[[plugins]]
repo = 'tyru/open-browser-unicode.vim'
on_cmd = 'OpenBrowserUnicode'
depends = 'open-browser.vim'
hook_add = '''
  nnoremap <Leader>ou <Cmd>OpenBrowserUnicode<CR>
'''

[[plugins]]
repo = 'thinca/vim-prettyprint'
on_cmd = 'PP'
hook_add = '''
  let g:prettyprint_width = 78
  let g:prettyprint_indent = 2

  call extend(g:vimrc_altercmd_dic, {'pp': 'PP'})
'''

#[[plugins]]
#repo = 'ynkdir/vim-vimlparser'

[[plugins]]
repo = 'kana/vim-operator-user'

[[plugins]]
repo = 'fedorenchik/VimCalc3'
on_cmd = 'Calc'
hook_source = '''
  " Sayonara
  let g:sayonara_filetypes.vimcalc = 'bdelete'
'''

[[plugins]]
repo = 'kana/vim-submode'
hook_add = '''
  let g:submode_keep_leaving_key = 1
  let g:submode_timeout = 0

  " TODO: submode を抜けるときに <silent> を効かせたいけど方法はないのかな？

  " tab move
  call submode#enter_with('changetab', 'n', '', 'gt', 'gt')
  call submode#enter_with('changetab', 'n', '', 'gT', 'gT')
  call submode#map('changetab', 'n', '', 't', 'gt')
  call submode#map('changetab', 'n', '', 'T', 'gT')

  " 変更した位置
  call submode#enter_with('move-change', 'n', '', 'g;', 'g;')
  call submode#enter_with('move-change', 'n', '', 'g,', 'g,')
  call submode#map('move-change', 'n', '', ';', 'g;')
  call submode#map('move-change', 'n', '', ',', 'g,')
  call submode#map('move-change', 'n', '', ':', 'g,')

  " move to next/previous fold
  call submode#enter_with('move-to-fold', 'n', '', 'zj', 'zj')
  call submode#enter_with('move-to-fold', 'n', '', 'zk', 'zk')
  call submode#map('move-to-fold', 'n', '', 'j', 'zj')
  call submode#map('move-to-fold', 'n', '', 'k', 'zk')

  " 時系列 undo/redo
  call submode#enter_with('undo/redo', 'n', '', 'g-', 'g-')
  call submode#enter_with('undo/redo', 'n', '', 'g+', 'g+')
  call submode#map('undo/redo', 'n', '', '-', 'g-')
  call submode#map('undo/redo', 'n', '', '+', 'g+')

  "https://raw.githubusercontent.com/ryotako/dotfiles/52b1ecb275e577dcb44db367a1f563d471c2cab0/.vimrc
  " x 連打削除を一つの undo で戻るように
  " レジスタに登録しない "_x
  call submode#enter_with('x', 'n', '', 'x', '"_x')
  call submode#map('x', 'n', 's', 'x', ":<C-u>undojoin <bar> normal! \"_x<CR>")

  " diff
  call submode#enter_with('diff', 'n', '', 'dn', ']c')
  call submode#enter_with('diff', 'n', '', 'dp', '[c')
  call submode#map('diff', 'n', '', 'n', ']c')
  call submode#map('diff', 'n', '', 'p', '[c')
  call submode#enter_with('diff', 'n', '', 'dj', ']c')
  call submode#enter_with('diff', 'n', '', 'dk', '[c')
  call submode#map('diff', 'n', '', 'j', ']c')
  call submode#map('diff', 'n', '', 'k', '[c')

  " Visual モード時のインクリメント、デクリメント
  " http://vim-jp.org/blog/2015/06/30/visual-ctrl-a-ctrl-x.html
  call submode#enter_with('vinc', 'x', '', '<Leader>a', '<c-a>gv')
  call submode#enter_with('vinc', 'x', '', '<Leader>x', '<c-x>gv')
  call submode#map('vinc', 'x', '', 'a', '<c-a>gv')
  call submode#map('vinc', 'x', '', 'x', '<c-x>gv')
'''

# [[plugins]]
# repo = 'vim-jp/vital.vim'
# depends = 'vital-Whisky'
# on_cmd = 'Vitalize'

# [[plugins]]
# repo = 'lambdalisue/vital-Whisky'
# lazy = 1

[[plugins]]
repo = 'vim-jp/vimdoc-ja'

# Vim に追加された機能のバージョンを確認
[[plugins]]
repo = 'tweekmonster/helpful.vim'
on_cmd = 'HelpfulVersion'
hook_add = '''
  call extend(g:vimrc_altercmd_dic, {'helpfu\%[lVersion]': 'L HelpfulVersion'})
'''

[[plugins]]
repo = 'rbtnn/vim-layout'
depends = 'ctrlp-generic'
on_func = ['layout#', 'LayoutWrap', 'LayoutCallback']
on_cmd = ['LayoutLoad', 'LayoutSave']
hook_add = '''
  let g:layout_path = '~/_vim/.layout/layout.json'

  call extend(g:vimrc_altercmd_dic, {'ss': 'call LayoutWrap()'})

  nnoremap <Leader>fs <Cmd>CtrlPLayout<CR>
  command! -nargs=* CtrlPLayout call CtrlPGeneric(glob(fnamemodify(g:layout_path, ':p:h') .. '/*', v:true, v:true), 'LayoutCallback')
'''
hook_source = '''
  function! LayoutWrap() abort
    let str = input('Filename: ')
    if len(str) == 0
      return 1
    endif
    call layout#save(fnamemodify(g:layout_path, ':p:h') .. '/' .. str .. '.json')
  endfunction

  function! LayoutCallback(selected_value) abort
    call layout#load(a:selected_value)
  endfunction
'''

[[plugins]]
repo = 'vim-denops/denops.vim'
lazy = 1
#hook_source = '''
#   let g:denops#debug = 1
#   let g:denops#trace = 1
#
#  " for profile
#  let g:denops#server#deno_args = [
#      \ '-q',
#      \ '--no-check',
#      \ '--unstable',
#      \ '-A',
#      \ '--inspect',
#      \ ]
#'''

# }}}1

